const playerChannel=new BroadcastChannel("player_channel"),roleChannel=new BroadcastChannel("role_channel"),statusChannel=new BroadcastChannel("status_channel"),bestMoveChannel=new BroadcastChannel("best_move_channel"),resetChannel=new BroadcastChannel("reset_channel"),resetAllChannel=new BroadcastChannel("reset_all_channel");axios.defaults.baseURL=window.baseURL;const defaultImages={civil:"",mafia:""};let initialDocument;async function getDefaultImages(){let e;try{await axios.get("/default",{headers:{Authorization:"Bearer "+window.token}}).then((l=>e=l.data)).catch((e=>console.error("[Запрос] Ошибка:",e.message)))}catch(e){console.error("Ошибка:",e.message)}if(!e)return void console.error("Ошибка запроса стандартных фотографий с сервера");defaultImages.civil=e.civil,defaultImages.mafia=e.mafia;document.querySelectorAll(".card-container").forEach((e=>{e.children[1].style.backgroundImage=`url("${defaultImages.civil}")`})),initDocument()}function init(){getDefaultImages()}function getDefaultImage(e){return e.setAttribute("image","default"),"civil"===e.getAttribute("role")?`url("${defaultImages.civil}")`:`url("${defaultImages.mafia}")`}function changeImage(e){"custom"!==e.getAttribute("image")&&("civil"===e.getAttribute("role")?e.children[1].style.backgroundImage=`url("${defaultImages.civil}")`:e.children[1].style.backgroundImage=`url("${defaultImages.mafia}")`)}function initDocument(){const e=document.getElementById("container");initialDocument=e.cloneNode(!0)}playerChannel.onmessage=e=>{const l=e.data,a=document.getElementById(`${l.pos}`);a.setAttribute("image","custom"),a.children[1].style.backgroundImage=""===l.player.image?getDefaultImage(a):`url("${l.player.image})`,a.children[2].children[1].innerHTML=l.player.name},roleChannel.onmessage=e=>{const l=e.data,a=document.getElementById(`${l.pos}`),n=a.children[1];"Civil"===l.role||"Mafia"===l.role?(n.children[0].style.display="none",n.children[0].children[0].style.display="none",n.children[0].children[1].style.display="none","Civil"===l.role?(n.className=n.className.includes("removed")?"card-photo civil removed":"card-photo civil",a.children[0].className="card-bestMove background-civil",a.children[2].className="card-info background-civil",a.setAttribute("role","civil")):(n.className=n.className.includes("removed")?"card-photo mafia removed":"card-photo mafia",a.children[0].className="card-bestMove background-mafia",a.children[2].className="card-info background-mafia",a.setAttribute("role","mafia"))):"Sheriff"===l.role?(n.children[0].style.display="flex",n.children[0].children[0].style.display="block",n.children[0].children[1].style.display="none",n.className=n.className.includes("removed")?"card-photo civil removed":"card-photo civil",a.children[0].className="card-bestMove background-civil",a.children[1].children[0].className="card-role background-civil",a.children[2].className="card-info background-civil",a.setAttribute("role","civil")):(n.children[0].style.display="flex",n.children[0].children[0].style.display="none",n.children[0].children[1].style.display="block",n.className=n.className.includes("removed")?"card-photo mafia removed":"card-photo mafia",a.children[0].className="card-bestMove background-mafia",a.children[1].children[0].className="card-role background-mafia",a.children[2].className="card-info background-mafia",a.setAttribute("role","mafia")),changeImage(a)},statusChannel.onmessage=e=>{const l=e.data,a=document.getElementById(`${l.pos}`),n=a.children[0],c=a.children[1].children[1].children[0].children[0],i=a.children[1].children[1].children[0].children[1],s=a.children[1].children[1].children[0].children[2];"Alive"===l.status?(a.children[1].className=a.children[1].className.replace(" removed",""),a.children[1].children[1].className=a.children[1].children[1].className.replace(" removed",""),c.style.display="none",i.style.display="none",s.style.display="none",n.style.display="none",n.id=""):(a.children[1].className=a.children[1].className.includes(" removed")?a.children[1].className:a.children[1].className+" removed",a.children[1].children[1].className=a.children[1].children[1].className.includes(" removed")?a.children[1].children[1].className:a.children[1].children[1].className+" removed","First"===l.status?(c.style.display="block",i.style.display="none",s.style.display="none",n.style.display="flex",n.id="activeBestMove"):("Killed"===l.status?(c.style.display="block",i.style.display="none",s.style.display="none"):"Upvoted"===l.status?(s.style.display="block",c.style.display="none",i.style.display="none"):(i.style.display="block",c.style.display="none",s.style.display="none"),n.style.display="none",n.id=""))},bestMoveChannel.onmessage=e=>{const l=e.data;document.querySelectorAll("#activeBestMove").forEach((e=>{switch(l.bestMoveId){case 1:e.children[1].children[0].innerHTML=l.number;break;case 2:e.children[1].children[2].innerHTML=l.number;break;case 3:e.children[1].children[4].innerHTML=l.number}}))},resetChannel.onmessage=()=>{document.querySelectorAll(".card-container").forEach((e=>{e.setAttribute("role","civil");const l=e.children[0];l.id="",l.style.display="none",l.className="card-bestMove background-civil";const a=l.children[1];a.children[0].innerHTML="?",a.children[2].innerHTML="?",a.children[4].innerHTML="?";const n=e.children[1];n.className="card-photo civil";const c=n.children[0];c.style.display="none",c.className="card-role background-civil",c.children[0].style.display="none",c.children[1].style.display="none";const i=n.children[1];i.className="card-status-container";const s=i.children[0];s.children[0].style.display="none",s.children[1].style.display="none",s.children[2].style.display="none";e.children[2].className="card-info background-civil"}))},resetAllChannel.onmessage=()=>{const e=document.getElementById("container"),l=document.getElementById("body"),a=initialDocument.cloneNode(!0);l.removeChild(e),l.appendChild(a)},init();